<div class="ct-reports-page">
    <div class="ct-page-container">
        <!--<div *ngIf="datePeriod.dateFrom && datePeriod.dateTo" class="ct-period-for-print ct-print-mode">-->
        <!--Period: {{formatDate(datePeriod.dateFrom)}} - {{formatDate(datePeriod.dateTo)}}-->
        <!--</div>-->

        <div *ngIf="reportDropdowns">
            <div class="ct-reports-chart-container">
                <h3 class="ct-reports-panel-header">
                    Filters
                </h3>

                <div class="ct-reports-time-period-block">
                    <div class="ct-reports-time-period">
                        <a class="fa fa-angle-left" (click)="getNewPeriod(false)"></a>
                        <div>
                            <span (click)="toggleRangeDatepicker()" [title]="dateString">{{dateString}}</span>
                            <i *ngIf="isDatepickerShown" class="fa fa-times" (click)="cancelUpdatingReportGrid()"></i>
                            <i *ngIf="!isDatepickerShown" class="fa fa-angle-down" (click)="toggleRangeDatepicker()"></i>
                        </div>
                        <a class="fa fa-angle-right" (click)="getNewPeriod()"></a>
                    </div>
                    <ct-range-datepicker *ngIf="isDatepickerShown"
                                         [class.ct-datepicker-opened]="isDatepickerAnimating"
                                         [dateResponse]="dateResponse"
                                         [datePeriodList]="reportDropdowns?.values.dateStatic"
                                         [firstDayOfWeek]="firstDayOfWeek"
                                         (clickOutside)="toggleRangeDatepicker($event)"
                                         (onPeriodChanged)="datePeriodOnChange($event)"
                                         (closed)="toggleRangeDatepicker()"></ct-range-datepicker>
                </div>

                <div class="ct-report-filters-block">
                    <div>
                        <ct-multiselect
                                [panelStyleClass]="'ct-reports-multiselect ct-clients'"
                                [(ngModel)]="reportFilters.clientIds"
                                (onSubmitAction)="toggleClient(reportFilters.clientIds)"
                                [showSubmitButton]="true"
                                [appendTo]="'body'"
                                [defaultLabel]="'All Clients'"
                                [options]="clientItems"
                                [extraActionTitle]="showOnlyActiveClients ? 'Show archived' : 'Hide archived'"
                                (onExtraAction)="toggleArchivedClients()"
                                [maxSelectedLabels]="'1'"
                                [selectedItemsLabel]="'Clients ({0})'">
                        </ct-multiselect>
                    </div>
                    <div>
                        <ct-multiselect
                                [panelStyleClass]="'ct-reports-multiselect ct-projects'"
                                [(ngModel)]="reportFilters.projectIds"
                                (onSubmitAction)="toggleProject(reportFilters.projectIds)"
                                [showSubmitButton]="true"
                                [appendTo]="'body'"
                                [defaultLabel]="'All Projects'"
                                [options]="projectItems"
                                [extraActionTitle]="showOnlyActiveProjects ? 'Show archived' : 'Hide archived'"
                                (onExtraAction)="toggleArchivedProjects()"
                                [maxSelectedLabels]="'1'"
                                [selectedItemsLabel]="'Projects ({0})'">
                        </ct-multiselect>
                    </div>
                    <div>
                        <ct-multiselect
                                *ngIf="isUsersFilterShown"
                                [panelStyleClass]="'ct-reports-multiselect ct-users'"
                                [(ngModel)]="reportFilters.memberIds"
                                (onSubmitAction)="toggleUser()"
                                [showSubmitButton]="true"
                                [appendTo]="'body'"
                                [defaultLabel]="'All Users'"
                                [options]="userItems"
                                [extraActionTitle]="showOnlyActiveUsers ? 'Show archived' : 'Hide archived'"
                                (onExtraAction)="toggleArchivedUsers()"
                                [maxSelectedLabels]="'1'"
                                [selectedItemsLabel]="'Users ({0})'">
                        </ct-multiselect>
                    </div>
                </div>

                <div class="ct-report-filters-block">
                    <label class="ct-filter-label">Group by</label>
                    <ct-select [name]="'groupBy'"
                               [defaultValue]="'Date'"
                               [displayName]="'description'" [trackBy]="'id'"
                               [(ngModel)]="groupModel"
                               (change)="groupByChange()"
                               [options]="groupByItems">
                    </ct-select>
                </div>

                <div class="ct-query-block">
                    <div class="ct-report-query-links">
                        <button type="button" class="ct-reports-reset-link" title="Clear filters"
                                (click)="resetFilters()">
                            <i class="material-icons">clear</i><span>Clear filters</span>
                        </button>
                        <button type="button" class="ct-query-add-box" title="Save query"
                                (click)="openQueryDialog()">
                            <i class="material-icons">star</i><span>Save query</span>
                        </button>
                    </div>

                    <ct-select *ngIf="queryItems.length"
                               [name]="'query'" [defaultValue]="'Select Saved Query'"
                               [displayName]="'queryName'" [trackBy]="'queryId'"
                               [(ngModel)]="queryModel"
                               (change)="queryOnChange(queryModel)"
                               [options]="queryItems">
                    </ct-select>
                    <span *ngIf="queryModel" class="ct-delete-icon material-icons" title="Delete query"
                          (click)="deleteQuery(queryModel)">clear</span>
                </div>
            </div>

            <div class="ct-reports-grid-container">
                <div class="ct-page-header">
                    <div class="ct-report-filters">
                        <div class="ct-btn-settings-block ct-btn-block">
                            <ct-multiselect class="ct-columns-multiselect ct-columns-button" title="Columns settings"
                                            [styleClass]="'ct-reports-settings-multiselect'"
                                            [(ngModel)]="reportFilters.showColumnIds"
                                            (onSubmitAction)="submitSettings(reportFilters.showColumnIds)"
                                            [showSubmitButton]="true"
                                            [showActionsPanel]="false"
                                            [showFilterSearch]="false"
                                            [appendTo]="'body'"
                                            [options]="showColumnItems">
                            </ct-multiselect>
                        </div>
                        <div class="ct-btn-block">
                            <div class="ct-export-as">
                                <span class="ct-export-button" (click)="menu.toggleMenu()" title="Export reports"></span>
                                <ct-menu #menu [xPosition]="'before'" class="ct-actions-drop-menu">
                                    <ct-menu-item>
                                        <a mat-ripple (click)="exportAs(0)">Export as Excel</a>
                                    </ct-menu-item>
                                    <!--<ct-menu-item>-->
                                    <!--<a mat-ripple (click)="exportAs(1)">Export as CSV</a>-->
                                    <!--</ct-menu-item>-->
                                    <ct-menu-item>
                                        <a mat-ripple (click)="exportAs(2)">Export as PDF</a>
                                    </ct-menu-item>
                                </ct-menu>
                            </div>
                            <span class="ct-print-button" (click)="checkDataAndPrintPage()" title="Print page"></span>
                            <span class="ct-send-button" (click)="openSendReportsDialog()" title="Send reports"></span>
                        </div>

                    </div>
                </div>

                <div class="ct-reports-data" #scrollContainer>
                    <ct-reports-grid *ngFor="let grid of gridData"
                                     class="ct-reports-grid"
                                     [gridData]="grid.gridData"
                                     [groupById]="groupModel?.id"
                                     [rowsNumber]="grid.rows"
                                     [showColumnIds]="showColumnIds"></ct-reports-grid>

                    <div *ngIf="reportsGridData?.groupedItems.length == 0" class="ct-nodata">
                        Sorry, you don't have any reports at this time period.
                    </div>
                </div>

                <div *ngIf="reportsGridData?.timeTotal.timeActualTotal > 0" class="ct-grid-container ct-total-footer ct-total-time-container">
                    <label>Total Hours</label>

                    <div class="ct-total-hours-tracked">
                        <span *ngIf="reportsGridData.timeTotal.timeEstimatedTotal > 0" class="ct-estimated-label">&nbsp;&nbsp;Estimated: {{getTimeString(reportsGridData?.timeTotal.timeEstimatedTotal)}}</span>
                        <span *ngIf="getTimeString(reportsGridData?.timeTotal.timeActualTotal, true)" class="ct-actual-label">Actual: {{getTimeString(reportsGridData?.timeTotal.timeActualTotal, true)}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>